[gcode_macro M900]
description: Set pressure advance (Marlin)
gcode:
  {% if 'K' in params %}
    {% set k_factor = params.K|float %}
    {% if 'E' in params %}
      {action_respond_info("Extruder-specific K-factor setting is not typically used in Klipper. Applying K=" ~ k_factor ~ " to the default extruder.")}
    {% endif %}
    SET_PRESSURE_ADVANCE ADVANCE={k_factor}
    {action_respond_info("Pressure advance (K-factor) set to " ~ k_factor ~ ".")}
  {% else %}
    {action_respond_info("M900 command received without K parameter. Please specify K value to set pressure advance.")}
  {% endif %}
