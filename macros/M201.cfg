[gcode_macro M201]
description: Set maximum acceleration (Marlin)
gcode:
    # M201 sets the maximum acceleration in Marlin. This macro adapts it for Klipper.
    {% if 'X' in params %}
        {% set x_accel = params.X|float %}
        SET_VELOCITY_LIMIT ACCEL={x_accel}
        {action_respond_info("Set maximum X acceleration to " ~ x_accel)}
    {% endif %}
    {% if 'Y' in params %}
        {% set y_accel = params.Y|float %}
        SET_VELOCITY_LIMIT ACCEL={y_accel}
        {action_respond_info("Set maximum Y acceleration to " ~ y_accel)}
    {% endif %}
    {% if 'Z' in params %}
        {% set z_accel = params.Z|float %}
        SET_VELOCITY_LIMIT ACCEL={z_accel}
        {action_respond_info("Set maximum Z acceleration to " ~ z_accel)}
    {% endif %}
    {% if 'E' in params %}
        {% set e_accel = params.E|float %}
        SET_VELOCITY_LIMIT EXTRUDER={e_accel}
        {action_respond_info("Set maximum extruder acceleration to " ~ e_accel)}
    {% endif %}
    {% if 'X' not in params and 'Y' not in params and 'Z' not in params and 'E' not in params %}
        {action_respond_info("M201 command received without parameters. No acceleration changes applied.")}
    {% endif %}
