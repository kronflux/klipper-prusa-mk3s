[gcode_macro M300]
description: Play tone (Marlin)
gcode:
    # Default to 1kHz if S is omitted, minimum frequency should be positive
    {% set S = params.S|default(1000)|int %}
    {% if S <= 0 %}
        {action_respond_info("Invalid frequency specified. Using default frequency 1000Hz.")}
        {% set S = 1000 %}
    {% endif %}
    
    # Default to 100ms if P is omitted
    {% set P = params.P|default(100)|int %}
    
    # Play tone
    SET_PIN PIN=BEEPER_pin VALUE=0.5 CYCLE_TIME={ 1.0/S }
    G4 P{P}
    SET_PIN PIN=BEEPER_pin VALUE=0
