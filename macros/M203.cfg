[gcode_macro M203]
description: Set maximum feedrate (Marlin)
gcode:
    # M203 sets the maximum feedrate (speed) for axes in Marlin. This macro adapts it for Klipper.
    {% if 'X' in params %}
        {% set x_feedrate = params.X|float %}
        SET_VELOCITY_LIMIT VELOCITY={x_feedrate}
        {action_respond_info("Set maximum X feedrate to " ~ x_feedrate ~ " mm/s")}
    {% endif %}
    {% if 'Y' in params %}
        {% set y_feedrate = params.Y|float %}
        SET_VELOCITY_LIMIT VELOCITY={y_feedrate}
        {action_respond_info("Set maximum Y feedrate to " ~ y_feedrate ~ " mm/s")}
    {% endif %}
    {% if 'Z' in params %}
        {% set z_feedrate = params.Z|float %}
        SET_VELOCITY_LIMIT VELOCITY={z_feedrate}
        {action_respond_info("Set maximum Z feedrate to " ~ z_feedrate ~ " mm/s")}
    {% endif %}
    {% if 'E' in params %}
        {% set e_feedrate = params.E|float %}
        SET_VELOCITY_LIMIT EXTRUDER={e_feedrate}
        {action_respond_info("Set maximum extruder feedrate to " ~ e_feedrate ~ " mm/s")}
    {% endif %}
    {% if 'X' not in params and 'Y' not in params and 'Z' not in params and 'E' not in params %}
        {action_respond_info("M203 command received without parameters. No feedrate changes applied.")}
    {% endif %}
